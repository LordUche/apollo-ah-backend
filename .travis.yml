language: node_js

node_js: 
  - node

cache: npm

env:
  global:
    - NODE_ENV=test

after_success:
  - npm run coverage

before_install:
  - npm i 

services:
  - postgresql

before_script:
  - psql -c 'CREATE DATABASE authorshaven;' -U postgres
  - psql -c "CREATE USER authorshaven WITH PASSWORD 'secret';" -U postgres

notifications:
  email: false

deploy:
  provider: heroku
  api_key:
    secure: QQpN+f5KmfVsasn7cEHe4CBk70hqrK2MHbCIZ9cW92JgyHeqd9TSRlzCQ3cigTA0xAFcnFKgoyq3b+JN2o/gxhfgRCCvbkbWJ4DbjcUcPrLmHeTXmd70D7D0zo1rSO7cAnmD8JFlEdPLSKfzDoHCW0BlPBdYVLb/qIKLoVQMsmeNVwYtKeAD7W5joOM4NzR8sNEznDKclJfpUjDv3eQtKvGU+g27jqvlzwvuWnfeDEYxawHoN1kPumahVCy/sqxLCE0XSISDDTHVx4AdLf2JnBGps0cfK13RIiTEcKUK0H4dq0CfsZRA2UYkN5hjozDv5Dp7MBvp78CPHZ53SN1u56a+bdLOg34bcK1McHAp0q+euBvrmYu/0j9ztKCJKzx+8LqX5Mk1LdJm56LNLXyW+eCvvgPim/eSVgKmj4j3nFRJjjdFAGrp7G4ycANMpW5lr5FVx++I+AOLhjgmNL79awIMSfw9UXy7oH3k3MqP9o4zFbOTc8X6w+Pzfsyxec9E19adhfqGMAZrZQ07ZmIKj/EHBGxz/lAIn2fj6NT1ALYcClxNHUayQ4B+uJEe3g30l9fZ32XnETc7ytKiQxPUeWnAOWoZOjAaXp2vDbxoTVl25x+9HT5vnRPcl06QYvG5oIcXJzOR59kw7MXOGckMgxXUyN6qaR0EjR5dMkyp8u4=
  app:
    staging: apollo-ah-backend-staging
    master: apollo-ah-backend
  run:
    - "npm run migrate"
    - "npm run seed"
